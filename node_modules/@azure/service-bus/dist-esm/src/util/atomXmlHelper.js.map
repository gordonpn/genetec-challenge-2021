{"version":3,"file":"atomXmlHelper.js","sourceRoot":"","sources":["../../../src/util/atomXmlHelper.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport {\n  HttpOperationResponse,\n  RestError,\n  ServiceClient,\n  WebResource,\n  parseXML,\n  stringifyXML,\n  stripRequest,\n  stripResponse,\n  RequestPrepareOptions,\n  OperationOptions\n} from \"@azure/core-http\";\n\nimport * as Constants from \"./constants\";\nimport { administrationLogger as logger } from \"../log\";\nimport { Buffer } from \"buffer\";\n\nimport { parseURL } from \"./parseUrl\";\nimport { isJSONLikeObject } from \"./utils\";\n\n/**\n * @internal\n * @hidden\n * Represents the internal ATOM XML serializer interface\n */\nexport interface AtomXmlSerializer {\n  serialize(requestBodyInJson: object): object;\n\n  deserialize(response: HttpOperationResponse): Promise<HttpOperationResponse>;\n}\n\n/**\n * @internal\n * @hidden\n * Utility to execute Atom XML operations as HTTP requests\n * @param webResource\n * @param serializer\n */\nexport async function executeAtomXmlOperation(\n  serviceBusAtomManagementClient: ServiceClient,\n  webResource: WebResource,\n  serializer: AtomXmlSerializer,\n  operationOptions: OperationOptions\n): Promise<HttpOperationResponse> {\n  if (webResource.body) {\n    const content: object = serializer.serialize(webResource.body);\n    webResource.body = stringifyXML(content, { rootName: \"entry\" });\n  }\n\n  if (webResource.method == \"PUT\") {\n    webResource.headers.set(\"content-length\", Buffer.byteLength(webResource.body));\n  }\n\n  logger.verbose(`Executing ATOM based HTTP request: ${webResource.body}`);\n\n  const reqPrepareOptions: RequestPrepareOptions = {\n    ...webResource,\n    headers: operationOptions.requestOptions?.customHeaders,\n    onUploadProgress: operationOptions.requestOptions?.onUploadProgress,\n    onDownloadProgress: operationOptions.requestOptions?.onDownloadProgress,\n    abortSignal: operationOptions.abortSignal,\n    spanOptions: operationOptions.tracingOptions?.spanOptions,\n    disableJsonStringifyOnBody: true\n  };\n  webResource = webResource.prepare(reqPrepareOptions);\n  webResource.timeout = operationOptions.requestOptions?.timeout || 0;\n  const response: HttpOperationResponse = await serviceBusAtomManagementClient.sendRequest(\n    webResource\n  );\n\n  logger.verbose(`Received ATOM based HTTP response: ${response.bodyAsText}`);\n\n  try {\n    if (response.bodyAsText) {\n      response.parsedBody = await parseXML(response.bodyAsText, { includeRoot: true });\n    }\n  } catch (err) {\n    const error = new RestError(\n      `Error occurred while parsing the response body - expected the service to return valid xml content.`,\n      RestError.PARSE_ERROR,\n      response.status,\n      stripRequest(response.request),\n      stripResponse(response)\n    );\n    logger.logError(err, \"Error parsing response body from Service\");\n    throw error;\n  }\n\n  return serializer.deserialize(response);\n}\n\n/**\n * @internal\n * @hidden\n * The key-value pairs having undefined/null as the values would lead to the empty tags in the serialized XML request.\n * Empty tags in the request body is problematic because of the following reasons.\n * - ATOM based management operations throw a \"Bad Request\" error if empty tags are included in the XML request body at top level.\n * - At the inner levels, Service assigns the empty strings as values to the empty tags instead of throwing an error.\n *\n * This method recursively removes the key-value pairs with undefined/null as the values from the request object that is to be serialized.\n *\n * @param {{ [key: string]: any }} resource\n */\nexport function sanitizeSerializableObject(resource: { [key: string]: any }) {\n  Object.keys(resource).forEach(function(property) {\n    if (resource[property] == undefined) {\n      delete resource[property];\n    } else if (isJSONLikeObject(resource[property])) {\n      sanitizeSerializableObject(resource[property]);\n    }\n  });\n}\n\n/**\n * @internal\n * @hidden\n * Serializes input information to construct the Atom XML request\n * @param resourceName Name of the resource to be serialized like `QueueDescription`\n * @param resource The entity details\n * @param allowedProperties The set of properties that are allowed by the service for the\n * associated operation(s);\n */\nexport function serializeToAtomXmlRequest(resourceName: string, resource: any): object {\n  const content: any = {};\n\n  content[resourceName] = Object.assign({}, resource);\n  sanitizeSerializableObject(content[resourceName]);\n\n  content[resourceName][Constants.XML_METADATA_MARKER] = {\n    xmlns: \"http://schemas.microsoft.com/netservices/2010/10/servicebus/connect\",\n    \"xmlns:i\": \"http://www.w3.org/2001/XMLSchema-instance\"\n  };\n\n  content[Constants.XML_METADATA_MARKER] = { type: \"application/xml\" };\n  const requestDetails: any = {\n    updated: new Date().toISOString(),\n    content: content\n  };\n  requestDetails[Constants.XML_METADATA_MARKER] = {\n    xmlns: \"http://www.w3.org/2005/Atom\"\n  };\n  return requestDetails;\n}\n\n/**\n * @internal\n * @hidden\n * Transforms response to contain the parsed data.\n * @param nameProperties The set of 'name' properties to be constructed on the\n * resultant object e.g., QueueName, TopicName, etc.\n * @param response\n * @param shouldParseResponse\n */\nexport async function deserializeAtomXmlResponse(\n  nameProperties: string[],\n  response: HttpOperationResponse\n): Promise<HttpOperationResponse> {\n  // If received data is a non-valid HTTP response, the body is expected to contain error information\n  if (response.status < 200 || response.status >= 300) {\n    throw buildError(response);\n  }\n\n  parseAtomResult(response, nameProperties);\n\n  return response;\n}\n\n/**\n * @internal\n * @hidden\n * Utility to deserialize the given JSON content in response body based on\n * if it's a single `entry` or `feed` and updates the `response.parsedBody` to hold the evaluated output.\n * @param response Response containing the JSON value in `response.parsedBody`\n * @nameProperties The set of 'name' properties to be constructed on the\n * resultant object e.g., QueueName, TopicName, etc.\n * */\nfunction parseAtomResult(response: HttpOperationResponse, nameProperties: string[]): void {\n  const atomResponseInJson = response.parsedBody;\n\n  let result: any;\n  if (!atomResponseInJson) {\n    response.parsedBody = undefined;\n    return;\n  }\n\n  if (atomResponseInJson.feed) {\n    result = parseFeedResult(atomResponseInJson.feed);\n  } else if (atomResponseInJson.entry) {\n    result = parseEntryResult(atomResponseInJson.entry);\n  }\n\n  if (result) {\n    if (Array.isArray(result)) {\n      result.forEach((entry: object) => {\n        setName(entry, nameProperties);\n      });\n    } else {\n      setName(result, nameProperties);\n    }\n    response.parsedBody = result;\n    return;\n  }\n\n  logger.warning(\n    \"Failure in parsing response body from service. Expected response to be in Atom XML format and have either feed or entry components, but received - %0\",\n    atomResponseInJson\n  );\n  throw new RestError(\n    \"Error occurred while parsing the response body - expected the service to return atom xml content with either feed or entry elements.\",\n    RestError.PARSE_ERROR,\n    response.status,\n    stripRequest(response.request),\n    stripResponse(response)\n  );\n}\n\n/**\n * @internal\n * @hidden\n * Utility to help parse given `entry` result\n * @param entry\n */\nfunction parseEntryResult(entry: any): object | undefined {\n  let result: any;\n\n  if (\n    typeof entry !== \"object\" ||\n    entry == null ||\n    typeof entry.content !== \"object\" ||\n    entry.content == null\n  ) {\n    return undefined;\n  }\n\n  const contentElementNames = Object.keys(entry.content).filter(function(key) {\n    return key !== Constants.XML_METADATA_MARKER;\n  });\n\n  if (contentElementNames && contentElementNames[0]) {\n    const contentRootElementName = contentElementNames[0];\n    delete entry.content[contentRootElementName][Constants.XML_METADATA_MARKER];\n    result = entry.content[contentRootElementName];\n\n    if (result) {\n      if (entry[Constants.XML_METADATA_MARKER]) {\n        result[Constants.ATOM_METADATA_MARKER] = entry[Constants.XML_METADATA_MARKER];\n      } else {\n        result[Constants.ATOM_METADATA_MARKER] = {};\n      }\n\n      result[Constants.ATOM_METADATA_MARKER][\"ContentRootElement\"] = contentRootElementName;\n\n      Object.keys(entry).forEach((property: string) => {\n        if (property !== \"content\" && property !== Constants.XML_METADATA_MARKER) {\n          result[Constants.ATOM_METADATA_MARKER][property] = entry[property];\n        }\n      });\n\n      return result;\n    }\n  }\n\n  return undefined;\n}\n\n/**\n * @internal\n * @hidden\n * Utility to help parse link info from the given `feed` result\n * @param feedLink\n */\nfunction parseLinkInfo(\n  feedLink: { [Constants.XML_METADATA_MARKER]: { rel: string; href: string } }[],\n  relationship: \"self\" | \"next\"\n): string | undefined {\n  if (!feedLink || !Array.isArray(feedLink)) {\n    return undefined;\n  }\n  for (const linkInfo of feedLink) {\n    if (linkInfo[Constants.XML_METADATA_MARKER].rel === relationship) {\n      return linkInfo[Constants.XML_METADATA_MARKER].href;\n    }\n  }\n  return undefined;\n}\n\n/**\n * @internal\n * @hidden\n * Utility to help parse given `feed` result\n * @param feed\n */\nfunction parseFeedResult(feed: any): object[] & { nextLink?: string } {\n  const result: object[] & { nextLink?: string } = [];\n  if (typeof feed === \"object\" && feed != null && feed.entry) {\n    if (Array.isArray(feed.entry)) {\n      feed.entry.forEach((entry: any) => {\n        const parsedEntryResult = parseEntryResult(entry);\n        if (parsedEntryResult) {\n          result.push(parsedEntryResult);\n        }\n      });\n    } else {\n      const parsedEntryResult = parseEntryResult(feed.entry);\n      if (parsedEntryResult) {\n        result.push(parsedEntryResult);\n      }\n    }\n    result.nextLink = parseLinkInfo(feed.link, \"next\");\n  }\n  return result;\n}\n\n/**\n * @internal\n * @hidden\n * @param {number} statusCode\n * @returns {statusCode is keyof typeof Constants.HttpResponseCodes}\n */\nfunction isKnownResponseCode(\n  statusCode: number\n): statusCode is keyof typeof Constants.HttpResponseCodes {\n  return !!(Constants.HttpResponseCodes as { [statusCode: number]: string })[statusCode];\n}\n\n/**\n * @internal\n * @hidden\n * Extracts the applicable entity name(s) from the URL based on the known structure\n * and instantiates the corresponding name properties to the deserialized response\n *\n * The pattern matching checks to extract entity names are based on following\n * constraints dictated by the service\n * - '/' is allowed in Queue and Topic names\n * - '/' is not allowed in Namespace, Subscription and Rule names\n * - Valid pathname URL structures used in the ATOM based management API are\n *     - `<namespace-component>/<topic-name>/Subscriptions/<subscription-name>/Rules/<rule-name>`\n *     - `<namespace-component>/<topic-name>/Subscriptions/<subscription-name>`\n *     - `<namespace-component>/<any-entity-name>`\n *\n * @param entry\n * @param nameProperties\n */\nfunction setName(entry: any, nameProperties: any): any {\n  if (entry[Constants.ATOM_METADATA_MARKER]) {\n    let rawUrl = entry[Constants.ATOM_METADATA_MARKER].id;\n\n    // The parsedUrl gets constructed differently for browser vs Node.\n    // It is specifically behaves different for some of the Atom based management API where\n    // the received URL in \"id\" element is of type \"sb:// ... \" and not a standard HTTP one\n    // Hence, normalizing the URL for parsing to work as expected in browser\n    if (rawUrl.startsWith(\"sb://\")) {\n      rawUrl = \"https://\" + rawUrl.substring(5);\n    }\n\n    const parsedUrl = parseURL(rawUrl);\n    const pathname: string = parsedUrl.pathname;\n\n    const firstIndexOfDelimiter = pathname.indexOf(\"/\");\n\n    if (pathname.match(\"(.*)/(.*)/Subscriptions/(.*)/Rules/(.*)\")) {\n      const lastIndexOfSubscriptionsDelimiter = pathname.lastIndexOf(\"/Subscriptions/\");\n      const firstIndexOfRulesDelimiter = pathname.indexOf(\"/Rules/\");\n      entry[nameProperties[0]] = pathname.substring(\n        firstIndexOfDelimiter + 1,\n        lastIndexOfSubscriptionsDelimiter\n      );\n      entry[nameProperties[1]] = pathname.substring(\n        lastIndexOfSubscriptionsDelimiter + 15,\n        firstIndexOfRulesDelimiter\n      );\n      entry[nameProperties[2]] = pathname.substring(firstIndexOfRulesDelimiter + 7);\n    } else if (pathname.match(\"(.*)/(.*)/Subscriptions/(.*)\")) {\n      const lastIndexOfSubscriptionsDelimiter = pathname.lastIndexOf(\"/Subscriptions/\");\n      entry[nameProperties[0]] = pathname.substring(\n        firstIndexOfDelimiter + 1,\n        lastIndexOfSubscriptionsDelimiter\n      );\n      entry[nameProperties[1]] = pathname.substring(lastIndexOfSubscriptionsDelimiter + 15);\n    } else if (pathname.match(\"(.*)/(.*)\")) {\n      entry[nameProperties[0]] = pathname.substring(firstIndexOfDelimiter + 1);\n    }\n  }\n}\n\n/**\n * @internal\n * @hidden\n * Utility to help construct the normalized `RestError` object based on given error\n * information and other data present in the received `response` object.\n * @param response\n */\nexport function buildError(response: HttpOperationResponse): RestError {\n  if (!isKnownResponseCode(response.status)) {\n    throw new RestError(\n      `Service returned an error response with an unrecognized HTTP status code - ${response.status}`,\n      \"ServiceError\",\n      response.status,\n      stripRequest(response.request),\n      stripResponse(response)\n    );\n  }\n\n  const errorBody = response.parsedBody;\n  let errorMessage;\n  if (typeof errorBody === \"string\") {\n    errorMessage = errorBody;\n  } else {\n    if (\n      errorBody == undefined ||\n      errorBody.Error == undefined ||\n      errorBody.Error.Detail == undefined\n    ) {\n      errorMessage =\n        \"Detailed error message information not available. Look at the 'code' property on error for more information.\";\n    } else {\n      errorMessage = errorBody.Error.Detail;\n    }\n  }\n\n  const errorCode = getErrorCode(response, errorMessage);\n\n  const error: RestError = new RestError(\n    errorMessage,\n    errorCode,\n    response.status,\n    stripRequest(response.request),\n    stripResponse(response)\n  );\n  return error;\n}\n\n/**\n * @internal\n * @hidden\n * Helper utility to construct user friendly error codes based on based on given error\n * information and other data present in the received `response` object.\n * @param response\n * @param errorMessage\n */\nfunction getErrorCode(response: HttpOperationResponse, errorMessage: string): string {\n  if (response.status == 401) {\n    return \"UnauthorizedRequestError\";\n  }\n  if (response.status == 404) {\n    return \"MessageEntityNotFoundError\";\n  }\n  if (response.status == 409) {\n    if (response.request.method == \"DELETE\") {\n      return \"ServiceError\";\n    }\n\n    if (response.request.method == \"PUT\" && response.request.headers.get(\"If-Match\") == \"*\") {\n      return \"ServiceError\";\n    }\n\n    if (errorMessage && errorMessage.toLowerCase().includes(\"subcode=40901\")) {\n      return \"ServiceError\";\n    }\n\n    return \"MessageEntityAlreadyExistsError\";\n  }\n\n  if (response.status == 403) {\n    if (errorMessage && errorMessage.toLowerCase().includes(\"subcode=40301\")) {\n      return \"InvalidOperationError\";\n    }\n    return \"QuotaExceededError\";\n  }\n\n  if (response.status == 400) {\n    return \"ServiceError\";\n  }\n\n  if (response.status == 503) {\n    return \"ServerBusyError\";\n  }\n\n  return (Constants.HttpResponseCodes as { [statusCode: number]: string })[response.status];\n}\n"]}